import { PrismaService } from '../prisma.service';
import { CreateWorkflowDto } from './dto/create-workflow.dto';
import { UpdateWorkflowDto } from './dto/update-workflow.dto';
import { UpdateEtapeDto } from './dto/update-etape.dto';
import { PaginationDto, PaginatedResponse } from '../common/dto/pagination.dto';
import { WorkflowsGateway } from './workflows.gateway';
export declare class WorkflowsService {
    private prisma;
    private workflowsGateway;
    constructor(prisma: PrismaService, workflowsGateway: WorkflowsGateway);
    create(createWorkflowDto: CreateWorkflowDto): Promise<{
        duration: number | null;
        etapes: {
            duration: number | null;
            valideParUser: {
                id: string;
                email: string | null;
                nom: string;
                prenom: string;
            } | null;
            assignedUser: {
                id: string;
                nom: string;
                prenom: string;
                telephone: string | null;
                specialite: string | null;
            } | null;
            id: string;
            createdAt: Date;
            updatedAt: Date;
            numeroEtape: number;
            description: string | null;
            workflowId: string;
            nomEtape: string;
            statut: import("@prisma/client").$Enums.EtapeStatus;
            sousStatutReception: import("@prisma/client").$Enums.SousStatutReception | null;
            sousStatutTechnique: import("@prisma/client").$Enums.SousStatutTechnique | null;
            formulaire: import("@prisma/client/runtime/client").JsonValue | null;
            dateDebut: Date | null;
            dateFin: Date | null;
            validePar: string | null;
            valideParId: string | null;
            assignedUserId: string | null;
            signatureGestionnaire: string | null;
            signatureTechnicien: string | null;
            signatureControleur: string | null;
            signatureClientReception: string | null;
            signatureGestionnaireVerification: string | null;
            signatureClientRestitution: string | null;
            dateReception: Date | null;
            dateVerification: Date | null;
            dateRestitution: Date | null;
            dateControleTechnicien: Date | null;
            dateControleInterop: Date | null;
            commentaires: string | null;
        }[];
        vehicle: {
            id: string;
            createdAt: Date;
            updatedAt: Date;
            immatriculation: string;
            marque: string;
            modele: string;
            annee: number;
            numeroSerie: string;
            creePar: string | null;
        };
        id: string;
        createdAt: Date;
        updatedAt: Date;
        statut: import("@prisma/client").$Enums.WorkflowStatus;
        dateDebut: Date;
        dateFin: Date | null;
        vehicleId: string;
        etapeActuelle: number;
        raisonAnnulation: string | null;
        dateAnnulation: Date | null;
        annulePar: string | null;
    } | null>;
    findAll(paginationDto: PaginationDto): Promise<PaginatedResponse<any>>;
    findOne(id: string): Promise<{
        duration: number | null;
        etapes: {
            duration: number | null;
            valideParUser: {
                id: string;
                email: string | null;
                nom: string;
                prenom: string;
            } | null;
            assignedUser: {
                id: string;
                nom: string;
                prenom: string;
                telephone: string | null;
                specialite: string | null;
            } | null;
            id: string;
            createdAt: Date;
            updatedAt: Date;
            numeroEtape: number;
            description: string | null;
            workflowId: string;
            nomEtape: string;
            statut: import("@prisma/client").$Enums.EtapeStatus;
            sousStatutReception: import("@prisma/client").$Enums.SousStatutReception | null;
            sousStatutTechnique: import("@prisma/client").$Enums.SousStatutTechnique | null;
            formulaire: import("@prisma/client/runtime/client").JsonValue | null;
            dateDebut: Date | null;
            dateFin: Date | null;
            validePar: string | null;
            valideParId: string | null;
            assignedUserId: string | null;
            signatureGestionnaire: string | null;
            signatureTechnicien: string | null;
            signatureControleur: string | null;
            signatureClientReception: string | null;
            signatureGestionnaireVerification: string | null;
            signatureClientRestitution: string | null;
            dateReception: Date | null;
            dateVerification: Date | null;
            dateRestitution: Date | null;
            dateControleTechnicien: Date | null;
            dateControleInterop: Date | null;
            commentaires: string | null;
        }[];
        vehicle: {
            id: string;
            createdAt: Date;
            updatedAt: Date;
            immatriculation: string;
            marque: string;
            modele: string;
            annee: number;
            numeroSerie: string;
            creePar: string | null;
        };
        id: string;
        createdAt: Date;
        updatedAt: Date;
        statut: import("@prisma/client").$Enums.WorkflowStatus;
        dateDebut: Date;
        dateFin: Date | null;
        vehicleId: string;
        etapeActuelle: number;
        raisonAnnulation: string | null;
        dateAnnulation: Date | null;
        annulePar: string | null;
    } | null>;
    findOneWithPermissions(id: string, userId: string, userRole: string): Promise<{
        etapes: any[];
        duration: number | null;
        vehicle: {
            id: string;
            createdAt: Date;
            updatedAt: Date;
            immatriculation: string;
            marque: string;
            modele: string;
            annee: number;
            numeroSerie: string;
            creePar: string | null;
        };
        id: string;
        createdAt: Date;
        updatedAt: Date;
        statut: import("@prisma/client").$Enums.WorkflowStatus;
        dateDebut: Date;
        dateFin: Date | null;
        vehicleId: string;
        etapeActuelle: number;
        raisonAnnulation: string | null;
        dateAnnulation: Date | null;
        annulePar: string | null;
    } | null>;
    getUserPermissionsForWorkflow(workflowId: string, userId: string, userRole: string): Promise<Record<number, import("@prisma/client").$Enums.PermissionType[]>>;
    validateEtapeUpdate(workflowId: string, numeroEtape: number, updateDto: UpdateEtapeDto, userId: string, userRole: string): Promise<void>;
    private filterEtapesByViewPermission;
    private getUserPermissionsForEtape;
    update(id: string, updateWorkflowDto: UpdateWorkflowDto): Promise<{
        id: string;
        createdAt: Date;
        updatedAt: Date;
        statut: import("@prisma/client").$Enums.WorkflowStatus;
        dateDebut: Date;
        dateFin: Date | null;
        vehicleId: string;
        etapeActuelle: number;
        raisonAnnulation: string | null;
        dateAnnulation: Date | null;
        annulePar: string | null;
    }>;
    private canStartEtape;
    updateEtape(workflowId: string, numeroEtape: number, updateEtapeDto: UpdateEtapeDto, userId?: string, userRole?: string): Promise<any>;
    cancelWorkflow(id: string, raison: string, userId: string, userName: string, userRole: string): Promise<{
        vehicle: {
            id: string;
            createdAt: Date;
            updatedAt: Date;
            immatriculation: string;
            marque: string;
            modele: string;
            annee: number;
            numeroSerie: string;
            creePar: string | null;
        };
    } & {
        id: string;
        createdAt: Date;
        updatedAt: Date;
        statut: import("@prisma/client").$Enums.WorkflowStatus;
        dateDebut: Date;
        dateFin: Date | null;
        vehicleId: string;
        etapeActuelle: number;
        raisonAnnulation: string | null;
        dateAnnulation: Date | null;
        annulePar: string | null;
    }>;
    restitution(id: string, signatureClientRestitution: string, userId: string): Promise<{
        duration: number | null;
        etapes: {
            duration: number | null;
            valideParUser: {
                id: string;
                email: string | null;
                nom: string;
                prenom: string;
            } | null;
            assignedUser: {
                id: string;
                nom: string;
                prenom: string;
                telephone: string | null;
                specialite: string | null;
            } | null;
            id: string;
            createdAt: Date;
            updatedAt: Date;
            numeroEtape: number;
            description: string | null;
            workflowId: string;
            nomEtape: string;
            statut: import("@prisma/client").$Enums.EtapeStatus;
            sousStatutReception: import("@prisma/client").$Enums.SousStatutReception | null;
            sousStatutTechnique: import("@prisma/client").$Enums.SousStatutTechnique | null;
            formulaire: import("@prisma/client/runtime/client").JsonValue | null;
            dateDebut: Date | null;
            dateFin: Date | null;
            validePar: string | null;
            valideParId: string | null;
            assignedUserId: string | null;
            signatureGestionnaire: string | null;
            signatureTechnicien: string | null;
            signatureControleur: string | null;
            signatureClientReception: string | null;
            signatureGestionnaireVerification: string | null;
            signatureClientRestitution: string | null;
            dateReception: Date | null;
            dateVerification: Date | null;
            dateRestitution: Date | null;
            dateControleTechnicien: Date | null;
            dateControleInterop: Date | null;
            commentaires: string | null;
        }[];
        vehicle: {
            id: string;
            createdAt: Date;
            updatedAt: Date;
            immatriculation: string;
            marque: string;
            modele: string;
            annee: number;
            numeroSerie: string;
            creePar: string | null;
        };
        id: string;
        createdAt: Date;
        updatedAt: Date;
        statut: import("@prisma/client").$Enums.WorkflowStatus;
        dateDebut: Date;
        dateFin: Date | null;
        vehicleId: string;
        etapeActuelle: number;
        raisonAnnulation: string | null;
        dateAnnulation: Date | null;
        annulePar: string | null;
    } | null>;
    remove(id: string): Promise<void>;
    getEtapesByWorkflow(workflowId: string): Promise<{
        id: string;
        createdAt: Date;
        updatedAt: Date;
        numeroEtape: number;
        description: string | null;
        workflowId: string;
        nomEtape: string;
        statut: import("@prisma/client").$Enums.EtapeStatus;
        sousStatutReception: import("@prisma/client").$Enums.SousStatutReception | null;
        sousStatutTechnique: import("@prisma/client").$Enums.SousStatutTechnique | null;
        formulaire: import("@prisma/client/runtime/client").JsonValue | null;
        dateDebut: Date | null;
        dateFin: Date | null;
        validePar: string | null;
        valideParId: string | null;
        assignedUserId: string | null;
        signatureGestionnaire: string | null;
        signatureTechnicien: string | null;
        signatureControleur: string | null;
        signatureClientReception: string | null;
        signatureGestionnaireVerification: string | null;
        signatureClientRestitution: string | null;
        dateReception: Date | null;
        dateVerification: Date | null;
        dateRestitution: Date | null;
        dateControleTechnicien: Date | null;
        dateControleInterop: Date | null;
        commentaires: string | null;
    }[]>;
    private calculateWorkflowDuration;
    private calculateStepDuration;
    getStatistics(): Promise<{
        totalVehicles: number;
        completedWorkflows: number;
        inProgressWorkflows: number;
        cancelledWorkflows: number;
        waitingWorkflows: number;
        restitutedWorkflows: number;
        vehiclesByStep: Record<number, number>;
        averageWorkflowTime: number | null;
    }>;
}
